var abiDecoder = require('abi-decoder');
var APIHelper = require('../helper/api-helper');
const bytecode = "0xc3f44c0a000000000000000000000000000000000000000000000000000000000000001c84ed29d19dbc9f4e68f5b3874a018118f8ea00cbe6c879eb68e92f9464bbab2070d5bb237daab2c9a7a58486d2ffb09c928bd4552b26d67fc220e1d39db7994a00000000000000000000000087ea811785c4bd30fc104c2543cf8ed90f7eeec700000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000164701b88260000000000000000000000002fe8036d79d1b2a4a41dc77db78388189cd1290d000000000000000000000000d2008bd144beaf203589be932a678d8b4cec565400000000000000000000000073fe5f0211f9aa0dec6849340415ea587a05360d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000008409b72b4600000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040656462386135353265653135643438343337313033306131343637376462346366636662303837366335636534373532636264303262643764383331373435320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

let decoderInstances = {};
let web3Instance;

function init(abis, web3) {
  web3Instance = web3;
  for (var name in abis) {
    const abiInstance = Object.create(abiDecoder);
    abiInstance.addABI(abis[name]);
    decoderInstances[name] = abiInstance;
  }
  return decoderInstances;
}

async function decodeInitialTransaction(abiDecoderInstance, txnHash) {
  let err, result;
  [err, result] = await APIHelper.to(web3Instance.eth.getTransaction(txnHash));
  if (err) {
    console.log("sdadada");
    console.log(err);
    throw err;
  }
  const decodedIntitialTransaction = abiDecoderInstance.decodeMethod(result.input);
  return decodedIntitialTransaction;
}

function decodeMethod(abiDecoderInstance, data) {
  return abiDecoderInstance.decodeMethod(data);
}

module.exports = {
  init: init,
  decodeMethod: decodeMethod,
  decodeInitialTransaction: decodeInitialTransaction
};